# Ruby on Rails ì œë„¤ë ˆì´í„°ì™€ í…œí”Œë¦¿ì„ ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘í•˜ê¸°

ë ˆì¼ì¦ˆì˜ [ë°°í„°ë¦¬ë¥¼ í¬í•¨í•˜ëŠ” ì ‘ê·¼ë°©ì‹(batteries-included, ì‘ì—…ì— í•„ìš”í•œ ë„êµ¬ë“¤ì„ ê°€ëŠ¥í•œ ëª¨ë‘ ì œê³µí•˜ëŠ” ë°©ì‹)](https://en.wikipedia.org/wiki/Batteries_Included)ì€ ê°€ì¥ í° ì¥ì ì¤‘ì— í•˜ë‚˜ì´ë‹¤. ê·¸ ì¤‘ì—ì„œë„ ë ˆì¼ì¦ˆì˜ ì œë„¤ë ˆì´í„° ë•ë¶„ì— ë‹¤ë¥¸ ì–´ë– í•œ í”„ë ˆì„ì›Œí¬ë„ ë³„ ë‹¤ë¥¸ ë…¸ë ¥ì—†ì´ ì²˜ìŒë¶€í„° ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

ë ˆì¼ì¦ˆë¥¼ ì–¼ë§ˆë‚˜ ì‚¬ìš©í–ˆë˜ ê°„ì— í•„ì—°ì ìœ¼ë¡œ ì œë„¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ë³´ì•˜ì„ ê²ƒì´ë‹¤. ìƒˆë¡œìš´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•˜ë‹¤ë©´ `rails new` ì»¤ë©˜ë“œë¥¼ ì‚¬ìš©í•œë‹¤. ìˆ˜ë§ì€ ëª¨ë¸ê³¼ ë·°ë¥¼ ë‹¤ë£¨ëŠ” ìŠ¤ìºí´ë“œë¥¼ ì‘ì„±í•´ì•¼í•œë‹¤ë©´ `rails generate scaffold`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ì™¸ì—ë„ ë‹¤ë¥¸ ì—¬ëŸ¬ ì œë„¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ì•±ì„ ì‘ì„±í•˜ê³  ìœ ì—°í•˜ê²Œ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” ì œë„¤ë ˆì´í„°ê°€ ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì§„ ì•ŠëŠ”ë‹¤. ì•„ë§ˆ ì œë„¤ë ˆì´í„°ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì œë„¤ë ˆì´í„°ë¥¼ ë§Œë“¤ì–´ì•¼ í•  í•„ìš”ê°€ ìˆì„ ê²ƒì´ë‹¤. ì´ë²ˆ ê¸€ì—ì„œ ì œë„¤ë ˆì´í„°ë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ì–´ë‚´ëŠ”ì§€ ì‚´í´ë³´ê³ ì í•œë‹¤. íŠ¹íˆ ë ˆì¼ì¦ˆì—ì„œ í…œí”Œë¦¿ì„ í™œìš©í•˜ì—¬ ì»¤ìŠ¤í…€ ì œë„¤ë ˆì´í„°ë¥¼ ë§Œë“œëŠ” ê²ƒì„ ì¤‘ì ì ìœ¼ë¡œ ë‹¤ë£¨ê³ ì í•œë‹¤.

## ë ˆì¼ì¦ˆ ì œë„¤ë ˆì´í„°ë€ ë¬´ì—‡ì¸ê°€?
íŒŒì´ì¬ì´ë‚˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•´ì£¼ëŠ” ì œë„¤ë ˆì´í„° í•¨ìˆ˜ì™€ëŠ” ë‹¤ë¥´ê²Œ ë ˆì¼ì¦ˆ ì œë„¤ë ˆì´í„°ëŠ” ì»¤ìŠ¤í…€ [Thor](https://github.com/rails/thor)ì»¤ë©˜ë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

ì—¬ëŸ¬ ì˜ˆì‹œê°€ ìˆê² ì§€ë§Œ ëŒ€í‘œì ìœ¼ë¡œ `rails generate model`ì„ ì‚¬ìš©í•˜ì—¬ ActiveRecordì˜ ëª¨ë¸ì„ ìƒì„±í•˜ê±°ë‚˜ `rails generate migration`ì„ ì‚¬ìš©í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì»¤ë§¨ë“œê°€ ìˆë‹¤. ë˜í•œ `rails generate generator`ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒˆë¡œìš´ ì œë„¤ë ˆì´í„°ë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆë‹¤.

ì œë„¤ë ˆì´í„°ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì œë„¤ë ˆì´í„°ë¥¼ í˜¸ì¶œí• ìˆ˜ë„ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `rails scaffold`ì˜ ê²½ìš°ì—ëŠ” ë‹¤ë¥¸ ì—¬ëŸ¬ ì œë„¤ë ˆì´í„°ë¥¼ í•¨ê»˜ í˜¸ì¶œí•œë‹¤. ì´ë¥¼ í†µí•´ íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì • í•  ìˆ˜ë„ ìˆìœ¼ë©°, ì ¬ ì„¤ì¹˜, íŠ¹ì • rake ì‘ì—…ì„ ìˆ˜í–‰í• ìˆ˜ë„ ìˆê³  ì´ì™¸ ê¸°íƒ€ ë‹¤ë¥¸ ì‘ì—…ë“¤ë„ ìˆ˜í–‰í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì´í•´ë¥¼ ë•ê¸°ìœ„í•´ ê°„ë‹¨í•œ ëª¨ë¸ì„ ìƒì„±í•˜ëŠ” spec ì œë„¤ë ˆì´í„°ë¥¼ ì‘ì„±í•´ë³´ì•˜ë‹¤.

## Ruby on Railsì—ì„œ ì»¤ìŠ¤í…€ ì œë„¤ë ˆì´í„°ë¥¼ ìƒì„±í•˜ê¸°

```zsh
rails generate generator model_spec
```

ìœ„ ì»¤ë§¨ë“œë¥¼ ì…ë ¥í•˜ë©´ `/lib/generators/model_spec.`ì—ì„œ ëª‡ê°€ì§€ ìƒˆë¡œìš´ íŒŒì¼ë“¤ì´ ìƒì„±ëœë‹¤. `lib/generators/model_spec/`ì— ìˆëŠ” `model_spec_generator`ë¥¼ ìˆ˜ì •í•˜ì—¬ ëª¨ë¸ spec íŒŒì¼ì„ í•´ë‹¹ ê²½ë¡œì— ìƒì„±í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

```rb
class ModelSpecGenerator < Rails::Generators::NamedBase
  source_root File.expand_path('templates', __dir__)

  def create_model_spec
    template_file = File.join('spec/models', class_path, "#{file_name}_spec.rb")
    template 'model_spec.rb.erb', template_file
  end
end
```

`template` ì»¤ë§¨ë“œëŠ” `lib/generators/model_spec/templates` ê²½ë¡œì— ìœ„ì¹˜í•œ í…œí”Œë¦¿ íŒŒì¼ì„ ì°¾ì•„ íŠ¹ì • ìœ„ì¹˜ì— ë Œë”ë§ í•˜ê²Œ ëœë‹¤. ì—¬ê¸°ì„œëŠ” `spec/models` ê²½ë¡œê°€ ë  ê²ƒì´ë‹¤. ì´í›„ í…œí”Œë¦¿ íŒŒì¼ì— ìˆëŠ” ERB ìŠ¤íƒ€ì¼ì˜ ë³€ìˆ˜ë¥¼ ëŒ€ì²´í•˜ê²Œ ëœë‹¤.

`source_root`ë¥¼ ì§€ì •í•´ë†“ê²Œë˜ë©´ í•´ë‹¹ ì œë„¤ë ˆì´í„°ëŠ” ì–´ë–¤ í…œí”Œë¦¿ íŒŒì¼ì„ ì°¸ì¡°í• ì§€ ì§€ì •í•  ìˆ˜ ìˆë‹¤. `lib/generators/model_spec/tempates/` ê²½ë¡œì— ìœ„ì¹˜í•œ `model_spec.rb` íŒŒì¼ í…œí”Œë¦¿ì€ ì•„ë˜ì™€ ê°™ì€ ëª¨ìŠµì´ë‹¤.

```rb
require 'rails_helper'

RSpec.describe <%= class_name %>, :model
  pending "add some examples to (or delete) #{__FILE__}"
end
```
ìœ„ íŒŒì¼ì„ ìƒì„±í•˜ê²Œ ë˜ë©´, ì œë„¤ë ˆì´í„°ëŠ” í•´ë‹¹ í…œí”Œë¦¿ì„ ì°¸ì¡°í•˜ì—¬ ìƒˆë¡œìš´ spec íŒŒì¼ì„ ìƒì„±í•œë‹¤.

```zsh
rails generate model_spec mymodel
```
ë§ì€ ë£¨ë¹„ ì ¬ë“¤ì´ ìœ„ ì˜ˆì‹œì™€ ë¹„ìŠ·í•œ êµ¬ì¡°ì˜ ì œë„¤ë ˆì´í„°ë¥¼ í•¨ê»˜ ì œê³µí•˜ê³  ìˆë‹¤. ê°€ì¥ ê°„ë‹¨í•œ êµ¬ì¡°ì˜ ì œë„¤ë ˆì´í„°ëŠ” [Rspec ì œë„¤ë ˆì´í„°](https://relishapp.com/rspec/rspec-rails/docs/generators)ì™€ [FactoryBot ì œë„¤ë ˆì´í„°](https://github.com/thoughtbot/factory_bot_rails#generators)ë¥¼ ê¼½ì„ ìˆ˜ ìˆë‹¤. ì´ì™¸ì—ë„ ë‹¤ë¥¸ ì—¬ëŸ¬ ì œë„¤ë ˆì´í„°ë¥¼ ì œê³µí•˜ëŠ” ì ¬ë“¤ì´ ìˆë‹¤.

í•´ë‹¹ ì ¬ë“¤ì´ ì œê³µí•˜ëŠ” ì œë„¤ë ˆì´ë“¤ì€ ìœ„ ì˜ˆì‹œë¡œ ë“  ì œë„¤ë ˆì´í„°ë³´ë‹¤ í›¨ì”¬ ê°„ê²°í•˜ê³  ì‹¤ìš©ì ì´ë‹¤.
The generators in various gems are more sophisticated than the one we created. We could make our generator take arguments or even hook it into existing generators such as `rails scaffold`. Refer to the [Rails generators documentation](https://guides.rubyonrails.org/generators.html#customizing-your-workflow) if you want to learn more.

So generators have the potential to simplify your workflow in an existing application. But can we also use generators to customize setting up a new application?

Enter templates!

## Templates in Ruby on Rails
As the name suggests, templates are files for customizing your application setup. Don't confuse these with the template files that we previously discussed! Under the hood, they are just generators with a specific purpose, as evidenced by the [template API](https://guides.rubyonrails.org/rails_application_templates.html#template-api). While not exactly identical to generators, they are very similar.

If you have an existing template file, you can use it like so:

```zsh
rails new myapp -m mytemplate.rb
```

Rather than specifying a local file, you may also specify a URL. This is especially useful as it allows you to share application templates.

```zsh
rails new myapp -m https://gist.github.com/appsignal/12345/raw/
```

You are not limited to using templates when running rails new either. If you've already set up an app, you can apply templates afterward by executing:

```zsh
rails app:template LOCATION=http://example.com/template.rb
```

Templates can be extremely useful. Who doesn't want to automate adding the same couple of gems and making the same configuration changes every time they create a new app? Creating your own application template is great fun â€” even if it doesn't save a lot of time in the long run.

## Creating Your Own Template in Rails
We now know about generators and how to use templates. Let's create a simple application template to automate some setup steps.

How you set up your Rails app is very much down to personal preference, but here's an example:

1. Install the dotenv gem.
2. Create a `.env.development` file for the development environment.
3. Adapt the database configuration file to use environment variables.
4. Optionally [install and set up Rspec](https://github.com/rspec/rspec-rails).
Let's create a local file â€” `mytemplate.rb` â€” and add `dotenv` using the `gem` command.

```rb
gem 'dotenv-rails', groups: [:development, :test]
```
As we've just added the dotenv gem, let's also create a `.env.development` file to contain our database configuration.

You can create a new file with specific content by using `create_file`. You won't find this in the template or generator documentation, as the method is supplied by Thor. You might also come across the alias `file`. Application templates are evaluated in the context of `Rails::Generators::AppGenerator`, and that's exactly [where the file alias is defined](https://github.com/rails/rails/blob/8f39fbe18a57ae74513edc8561c00a369fe10f08/railties/lib/rails/generators/rails/app/app_generator.rb#L522).

```rb
create_file '.env.development', <<~TXT
  DATABASE_HOST=localhost
  DATABASE_USERNAME=#{app_name}
  DATABASE_PASSWORD=#{app_name}
TXT
```

The `app_name` variable contains the first argument of `rails new`. Using this variable, we can ensure our config file matches the generated application.

Next, let's use our environment variables to connect to the database. We could overwrite the entire `config/database.yml` using the `create_file` command, but let's modify it instead using [inject_into_file](https://guides.rubyonrails.org/generators.html#inject-into-file).

```rb
inject_into_file 'config/database.yml', after: /database: #{app_name}_development\n/ do <<-RUBY
  host: <%= ENV['DATABASE_HOST'] %>
  username: <%= ENV['DATABASE_USERNAME'] %>
  password: <%= ENV['DATABASE_PASSWORD'] %>
  RUBY
end
```
We can use both strings or regex with the `after` argument to specify where to inject content.

Of course, using this kind of configuration only makes sense if a user isn't creating an application with SQLite. You can check for the presence of certain arguments by using the `options` variable. It's best you read the [source code of Rails' app generator](https://github.com/rails/rails/blob/8f39fbe18a57ae74513edc8561c00a369fe10f08/railties/lib/rails/generators/database.rb#L14) to see which options are available.

```rb
if options[:database] != 'sqlite3'
  # Set up env vars and db configuration
end
```

Last but not least, let's also allow users to install Rspec if they want to. There are various methods for taking user input and creating interactive templates. The `yes?` method asks a user for confirmation:

```rb
if yes?('Would you like to install Rspec?')
  gem 'rspec-rails', group: :test
  after_bundle { generate 'rspec:install' }
end
```

We already know the `gem` method, but `generate` and `after_bundle` are new.

As mentioned before, Rspec adds its own generators, and you can call these generators (or any other ones, for that matter) directly from your template. But there is a catch â€” gems specified with the `gem` method are only installed at the end of the template. Calling `generate` with a generator supplied by such a gem would fail â€” which is why you should register the command as a callback with `after_bundle`.

Note: Before we wrap up, a quick word about creating or modifying files. We used `create_file` and `inject_into_file`, but there are many other options. You may come across `copy_file` or `template` when reading different templates. I did not mention them here to keep things simple. If you want to create more advanced templates, you should know that these other methods for dealing with files exist.

## The Result: The Final Template in Rails
The final template should look like this:

```rb
# Install dotenv
gem 'dotenv-rails', groups: [:development, :test]

if options[:database] != 'sqlite3'
  # Set up .env.development
  create_file '.env.development', <<~TXT
    DATABASE_HOST=localhost
    DATABASE_USERNAME=#{app_name}
    DATABASE_PASSWORD=#{app_name}
  TXT

  # Modify database.yml
  inject_into_file 'config/database.yml', after: /database: #{app_name}_development\n/ do <<-RUBY
  host: <%= ENV['DATABASE_HOST'] %>
  username: <%= ENV['DATABASE_USERNAME'] %>
  password: <%= ENV['DATABASE_PASSWORD'] %>
  RUBY
  end
end

# Optionally install Rspec
if yes?('Would you like to install Rspec?')
  gem 'rspec-rails', group: :test
  after_bundle { generate 'rspec:install' }
end
```

You can test this particular template by running:

```zsh
rails new myapp -m mytemplate.rb
```

Or:

```zsh
rails new myapp --database=postgresql mytemplate.rb
```

To take advantage of the custom database configuration.

As mentioned, this file is perfectly suited to share as a GitHub gist. Adapt it to suit your needs, upload it, and then share it with your colleagues, friends, and anyone else interested in your custom app template ğŸ˜‰.

## Learn More About Rails Generators and Templates
Needless to say, we've just scratched the surface here.

Everyone has different preferences for writing and developing Rails apps, so there are numerous generators and application templates out there. You can learn a lot about doing specific customizations by reading about them. I recommend [Chris Oliver's Jumpstart](https://github.com/excid3/jumpstart) and [RailsBytes](https://railsbytes.com/), the latter of which is a community-curated collection of templates.

There is also [Thoughtbot's Suspenders](https://github.com/thoughtbot/suspenders), which inspired me to dig deeper into Rails generators and templates. I even wrote my own application template â€” [Schienenzeppelin](https://github.com/hschne/schienenzeppelin) â€” which, while not up-to-date, might still provide some inspiration.

## Wrap Up: Get Started with Ruby on Rails Generators and Templates
In this post, we looked into the basics of Rails generators and how they are used. We created our own generators to simplify writing new model specs.

We then delved into templates and learned how you could create a simple template to customize your application setup. This can be a bit of work, but also quite rewarding. If writing your own templates is not for you, there are many existing ones online to choose from!

Original Source:
[Bootstrapping with Ruby on Rails Generators and Templates](https://blog.appsignal.com/2022/05/04/bootstrapping-with-ruby-on-rails-generators-and-templates.html)
